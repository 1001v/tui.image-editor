tui.util.defineNamespace("fedoc.content", {});
fedoc.content["imageEditor.js.html"] = "      <div id=\"main\" class=\"main\">\n\n\n\n    \n    <section>\n        <article>\n            <pre class=\"prettyprint source linenums\"><code>/**\n * @author NHN Ent. FE Development Team &lt;dl_javascript@nhnent.com>\n * @fileoverview Image-editor application class\n */\n'use strict';\n\nvar Invoker = require('./invoker');\nvar commandFactory = require('./factory/command');\nvar consts = require('./consts');\n\nvar events = consts.eventNames;\nvar commands = consts.commandNames;\nvar compList = consts.componentNames;\nvar states = consts.states;\n\n/**\n * Image editor\n * @class\n * @param {string|jQuery|HTMLElement} canvasElement - Canvas element or selector\n * @param {object} [option] - Canvas max width &amp; height of css\n *  @param {number} option.cssMaxWidth - Canvas css-max-width\n *  @param {number} option.cssMaxHeight - Canvas css-max-height\n */\nvar ImageEditor = tui.util.defineClass(/** @lends ImageEditor.prototype */{\n    init: function(canvasElement, option) {\n        option = option || {};\n        /**\n         * Invoker\n         * @private\n         * @type {Invoker}\n         */\n        this._invoker = new Invoker();\n\n        /**\n         * Fabric-Canvas instance\n         * @type {fabric.Canvas}\n         * @private\n         */\n        this._canvas = null;\n\n        /**\n         * Editor current state\n         * @private\n         * @type {string}\n         */\n        this._state = states.NORMAL;\n\n        this._setCanvas(canvasElement, option.cssMaxWidth, option.cssMaxHeight);\n        this._attachInvokerEvents();\n        this._attachCanvasEvents();\n    },\n\n    /**\n     * Attach invoker events\n     * @private\n     */\n    _attachInvokerEvents: function() {\n        var PUSH_UNDO_STACK = events.PUSH_UNDO_STACK;\n        var PUSH_REDO_STACK = events.PUSH_REDO_STACK;\n        var EMPTY_UNDO_STACK = events.EMPTY_UNDO_STACK;\n        var EMPTY_REDO_STACK = events.EMPTY_REDO_STACK;\n\n        /**\n         * @api\n         * @event ImageEditor#pushUndoStack\n         */\n        this._invoker.on(PUSH_UNDO_STACK, $.proxy(this.fire, this, PUSH_UNDO_STACK));\n        /**\n         * @api\n         * @event ImageEditor#pushRedoStack\n         */\n        this._invoker.on(PUSH_REDO_STACK, $.proxy(this.fire, this, PUSH_REDO_STACK));\n        /**\n         * @api\n         * @event ImageEditor#emptyUndoStack\n         */\n        this._invoker.on(EMPTY_UNDO_STACK, $.proxy(this.fire, this, EMPTY_UNDO_STACK));\n        /**\n         * @api\n         * @event ImageEditor#emptyRedoStack\n         */\n        this._invoker.on(EMPTY_REDO_STACK, $.proxy(this.fire, this, EMPTY_REDO_STACK));\n    },\n\n    /**\n     * Attach canvas events\n     * @private\n     */\n    _attachCanvasEvents: function() {\n        this._canvas.on({\n            'path:created': $.proxy(this._onPathCreated, this),\n            'object:added': $.proxy(function(event) {\n                var obj = event.target;\n                var command;\n\n                if (obj.isType('cropzone')) {\n                    return;\n                }\n\n                if (!tui.util.hasStamp(obj)) {\n                    command = commandFactory.create(commands.ADD_OBJECT, obj);\n                    this._invoker.pushUndoStack(command);\n                }\n                /**\n                 * @api\n                 * @event ImageEditor#addObject\n                 * @param {fabric.Object} obj - http://fabricjs.com/docs/fabric.Object.html\n                 * @example\n                 * imageEditor.on('addObject', function(obj) {\n                 *     console.log(obj);\n                 * });\n                 */\n                this.fire(events.ADD_OBJECT, obj);\n            }, this),\n            'object:removed': $.proxy(function(event) {\n                /**\n                 * @api\n                 * @event ImageEditor#removeObject\n                 * @param {fabric.Object} obj - http://fabricjs.com/docs/fabric.Object.html\n                 * @example\n                 * imageEditor.on('removeObject', function(obj) {\n                 *     console.log(obj);\n                 * });\n                 */\n                this.fire(events.REMOVE_OBJECT, event.target);\n            }, this)\n        });\n    },\n\n    /**\n     * EventListener - \"path:created\"\n     *  - Events:: \"object:added\" -> \"path:created\"\n     * @param {{path: fabric.Path}} obj - Path object\n     * @private\n     */\n    _onPathCreated: function(obj) {\n        var path = obj.path;\n\n        path.set({\n            rotatingPointOffset: 30,\n            borderColor: 'red',\n            transparentCorners: false,\n            cornerColor: 'green',\n            cornerSize: 10\n        });\n    },\n\n    /**\n     * Set canvas element\n     * @param {string|jQuery|HTMLElement} canvasElement - Canvas element or selector\n     * @param {number} cssMaxWidth - Canvas css max width\n     * @param {number} cssMaxHeight - Canvas css max height\n     * @private\n     */\n    _setCanvas: function(canvasElement, cssMaxWidth, cssMaxHeight) {\n        var mainComponent;\n\n        mainComponent = this._getMainComponent();\n        mainComponent.setCanvasElement(canvasElement);\n        mainComponent.setCssMaxDimension({\n            width: cssMaxWidth,\n            height: cssMaxHeight\n        });\n        this._canvas = mainComponent.getCanvas();\n    },\n\n    /**\n     * Returns main component\n     * @returns {Component} Main component\n     * @private\n     */\n    _getMainComponent: function() {\n        return this._getComponent(compList.MAIN);\n    },\n\n    /**\n     * Get component\n     * @param {string} name - Component name\n     * @returns {Component}\n     * @private\n     */\n    _getComponent: function(name) {\n        return this._invoker.getComponent(name);\n    },\n\n    /**\n     * Get current state\n     * @api\n     * @returns {string}\n     * @example\n     * // Image editor states\n     * //\n     * //    NORMAL: 'NORMAL'\n     * //    CROP: 'CROP'\n     * //    FREE_DRAWING: 'FREE_DRAWING'\n     * //\n     * if (imageEditor.getCurrentState() === 'FREE_DRAWING') {\n     *     imageEditor.endFreeDrawing();\n     * }\n     */\n    getCurrentState: function() {\n        return this._state;\n    },\n\n    /**\n     * Clear all objects\n     * @api\n     * @example\n     * imageEditor.clearObjects();\n     */\n    clearObjects: function() {\n        var command = commandFactory.create(commands.CLEAR_OBJECTS);\n        var callback = $.proxy(this.fire, this, events.CLEAR_OBJECTS);\n\n        /**\n         * @api\n         * @event ImageEditor#clearObjects\n         */\n        command.setExecuteCallback(callback);\n        this.execute(command);\n    },\n\n    /**\n     * End current action &amp; Deactivate\n     * @api\n     * @example\n     * imageEditor.startFreeDrawing();\n     * imageEidtor.endAll(); // === imageEidtor.endFreeDrawing();\n     *\n     * imageEditor.startCropping();\n     * imageEditor.endAll(); // === imageEidtor.endCropping();\n     */\n    endAll: function() {\n        this.endFreeDrawing();\n        this.endCropping();\n        this.deactivateAll();\n        this._state = states.NORMAL;\n    },\n\n    /**\n     * Deactivate all objects\n     * @api\n     * @example\n     * imageEditor.deactivateAll();\n     */\n    deactivateAll: function() {\n        this._canvas.deactivateAll();\n    },\n\n    /**\n     * Invoke command\n     * @param {Command} command - Command\n     */\n    execute: function(command) {\n        this.endAll();\n        this._invoker.invoke(command);\n    },\n\n    /**\n     * Undo\n     * @api\n     * @example\n     * imageEditor.undo();\n     */\n    undo: function() {\n        this.endAll();\n        this._invoker.undo();\n    },\n\n    /**\n     * Redo\n     * @api\n     * @example\n     * imageEditor.redo();\n     */\n    redo: function() {\n        this.endAll();\n        this._invoker.redo();\n    },\n\n    /**\n     * Load image from file\n     * @api\n     * @param {File} imgFile - Image file\n     * @param {string} [imageName] - imageName\n     * @example\n     * imageEditor.loadImageFromFile(file);\n     */\n    loadImageFromFile: function(imgFile, imageName) {\n        if (!imgFile) {\n            return;\n        }\n\n        this.loadImageFromURL(\n            URL.createObjectURL(imgFile),\n            imageName || imgFile.name\n        );\n    },\n\n    /**\n     * Load image from url\n     * @api\n     * @param {string} url - File url\n     * @param {string} imageName - imageName\n     * @example\n     * imageEditor.loadImageFromURL('http://url/testImage.png', 'lena')\n     */\n    loadImageFromURL: function(url, imageName) {\n        var self = this;\n        var callback, command;\n\n        if (!imageName || !url) {\n            return;\n        }\n\n        callback = $.proxy(this._callbackAfterImageLoading, this);\n        command = commandFactory.create(commands.LOAD_IMAGE, imageName, url);\n        command.setExecuteCallback(callback)\n            .setUndoCallback(function(oImage) {\n                if (oImage) {\n                    callback(oImage);\n                } else {\n                    /**\n                     * @api\n                     * @event ImageEditor#clearImage\n                     */\n                    self.fire(events.CLEAR_IMAGE);\n                }\n            });\n        this.execute(command);\n    },\n\n    /**\n     * Callback after image loading\n     * @param {?fabric.Image} oImage - Image instance\n     * @private\n     */\n    _callbackAfterImageLoading: function(oImage) {\n        var mainComponent = this._getMainComponent();\n        var $canvasElement = $(mainComponent.getCanvasElement());\n\n        /**\n         * @api\n         * @event ImageEditor#loadImage\n         * @param {object} dimension\n         *  @param {number} dimension.originalWidth - original image width\n         *  @param {number} dimension.originalHeight - original image height\n         *  @param {number} dimension.currentWidth - current width (css)\n         *  @param {number} dimension.current - current height (css)\n         * @example\n         * imageEditor.on('loadImage', function(dimension) {\n         *     console.log(dimension.originalWidth);\n         *     console.log(dimension.originalHeight);\n         *     console.log(dimension.currentWidth);\n         *     console.log(dimension.currentHeight);\n         * });\n         */\n        this.fire(events.LOAD_IMAGE, {\n            originalWidth: oImage.width,\n            originalHeight: oImage.height,\n            currentWidth: $canvasElement.width(),\n            currentHeight: $canvasElement.height()\n        });\n    },\n\n    /**\n     * Start cropping\n     * @api\n     * @example\n     * imageEditor.startCropping();\n     */\n    startCropping: function() {\n        var cropper;\n\n        if (this.getCurrentState() === states.CROP) {\n            return;\n        }\n\n        this.endAll();\n        this._state = states.CROP;\n        cropper = this._getComponent(compList.CROPPER);\n        cropper.start();\n        /**\n         * @api\n         * @event ImageEditor#startCropping\n         */\n        this.fire(events.START_CROPPING);\n    },\n\n    /**\n     * Apply cropping\n     * @api\n     * @param {boolean} [isApplying] - Whether the cropping is applied or canceled\n     * @example\n     * imageEditor.startCropping();\n     * imageEditor.endCropping(false); // cancel cropping\n     *\n     * imageEditor.startCropping();\n     * imageEditor.endCropping(true); // apply cropping\n     */\n    endCropping: function(isApplying) {\n        var cropper, data;\n\n        if (this.getCurrentState() !== states.CROP) {\n            return;\n        }\n\n        cropper = this._getComponent(compList.CROPPER);\n        this._state = states.NORMAL;\n        data = cropper.end(isApplying);\n        /**\n         * @api\n         * @event ImageEditor#endCropping\n         */\n        this.fire(events.END_CROPPING);\n        if (data) {\n            this.loadImageFromURL(data.url, data.imageName);\n        }\n    },\n\n    /**\n     * Flip\n     * @param {string} type - 'flipX' or 'flipY' or 'reset'\n     * @private\n     */\n    _flip: function(type) {\n        var callback = $.proxy(this.fire, this, events.FLIP_IMAGE);\n        var command = commandFactory.create(commands.FLIP_IMAGE, type);\n\n        /**\n         * @api\n         * @event ImageEditor#flipImage\n         * @param {object} flipSetting\n         *  @param {boolean} flipSetting.flipX - image.flipX\n         *  @param {boolean} flipSetting.flipY - image.flipY\n         * @param {number} angle - image.angle\n         * @example\n         * imageEditor.on('flipImage', function(flipSetting, angle) {\n         *     console.log('flipX: ', setting.flipX);\n         *     console.log('flipY: ', setting.flipY);\n         *     console.log('angle: ', angle);\n         * });\n         */\n        command.setExecuteCallback(callback)\n            .setUndoCallback(callback);\n        this.execute(command);\n    },\n\n    /**\n     * Flip x\n     * @api\n     * @example\n     * imageEditor.flipX();\n     */\n    flipX: function() {\n        this._flip('flipX');\n    },\n\n    /**\n     * Flip y\n     * @api\n     * @example\n     * imageEditor.flipY();\n     */\n    flipY: function() {\n        this._flip('flipY');\n    },\n\n    /**\n     * Reset flip\n     * @api\n     * @example\n     * imageEditor.resetFlip();\n     */\n    resetFlip: function() {\n        this._flip('reset');\n    },\n\n    /**\n     * @param {string} type - 'rotate' or 'setAngle'\n     * @param {number} angle - angle value (degree)\n     * @private\n     */\n    _rotate: function(type, angle) {\n        var callback = $.proxy(this.fire, this, events.ROTATE_IMAGE);\n        var command = commandFactory.create(commands.ROTATE_IMAGE, type, angle);\n\n        /**\n         * @api\n         * @event ImageEditor#rotateImage\n         * @param {number} currentAngle - image.angle\n         * @example\n         * imageEditor.on('rotateImage', function(angle) {\n         *     console.log('angle: ', angle);\n         * });\n         */\n        command.setExecuteCallback(callback)\n            .setUndoCallback(callback);\n        this.execute(command);\n    },\n\n    /**\n     * Rotate image\n     * @api\n     * @param {number} angle - Additional angle to rotate image\n     * @example\n     * imageEditor.setAngle(10); // angle = 10\n     * imageEditor.rotate(10); // angle = 20\n     * imageEidtor.setAngle(5); // angle = 5\n     * imageEidtor.rotate(-95); // angle = -90\n     */\n    rotate: function(angle) {\n        this._rotate('rotate', angle);\n    },\n\n    /**\n     * Set angle\n     * @api\n     * @param {number} angle - Angle of image\n     * @example\n     * imageEditor.setAngle(10); // angle = 10\n     * imageEditor.rotate(10); // angle = 20\n     * imageEidtor.setAngle(5); // angle = 5\n     * imageEidtor.rotate(50); // angle = 55\n     * imageEidtor.setAngle(-40); // angle = -40\n     */\n    setAngle: function(angle) {\n        this._rotate('setAngle', angle);\n    },\n\n    /**\n     * Start free-drawing mode\n     * @param {{width: number, color: string}} [setting] - Brush width &amp; color\n     * @api\n     * @example\n     * imageEditor.startFreeDrawing();\n     * imageEditor.endFreeDarwing();\n     * imageEidtor.startFreeDrawing({\n     *     width: 12,\n     *     color: 'rgba(0, 0, 0, 0.5)'\n     * });\n     */\n    startFreeDrawing: function(setting) {\n        if (this.getCurrentState() === states.FREE_DRAWING) {\n            return;\n        }\n\n        this.endAll();\n        this._getComponent(compList.FREE_DRAWING).start(setting);\n        this._state = states.FREE_DRAWING;\n\n        /**\n         * @api\n         * @event ImageEditor#startFreeDrawing\n         */\n        this.fire(events.START_FREE_DRAWING);\n    },\n\n    /**\n     * Set drawing brush\n     * @param {{width: number, color: string}} setting - Brush width &amp; color\n     * @api\n     * @example\n     * imageEditor.startFreeDrawing();\n     * imageEditor.setBrush({\n     *     width: 12,\n     *     color: 'rgba(0, 0, 0, 0.5)'\n     * });\n     * imageEditor.setBrush({\n     *     width: 8,\n     *     color: 'FFFFFF'\n     * });\n     */\n    setBrush: function(setting) {\n        this._getComponent(compList.FREE_DRAWING).setBrush(setting);\n    },\n\n    /**\n     * End free-drawing mode\n     * @api\n     * @example\n     * imageEditor.startFreeDrawing();\n     * imageEditor.endFreeDrawing();\n     */\n    endFreeDrawing: function() {\n        if (this.getCurrentState() !== states.FREE_DRAWING) {\n            return;\n        }\n        this._getComponent(compList.FREE_DRAWING).end();\n        this._state = states.NORMAL;\n\n        /**\n         * @api\n         * @event ImageEditor#endFreeDrawing\n         */\n        this.fire(events.END_FREE_DRAWING);\n    },\n\n    /**\n     * Remove active object or group\n     * @api\n     * @example\n     * imageEditor.removeActiveObject();\n     */\n    removeActiveObject: function() {\n        var canvas = this._canvas;\n        var target = canvas.getActiveObject() || canvas.getActiveGroup();\n        var command = commandFactory.create(commands.REMOVE_OBJECT, target);\n\n        this.execute(command);\n    },\n\n    /**\n     * Get data url\n     * @api\n     * @param {string} type - A DOMString indicating the image format. The default type is image/png.\n     * @returns {string} A DOMString containing the requested data URI\n     * @example\n     * imgEl.src = imageEditor.toDataURL();\n     */\n    toDataURL: function(type) {\n        return this._getMainComponent().toDataURL(type);\n    },\n\n    /**\n     * Get image name\n     * @api\n     * @returns {string} image name\n     * @example\n     * console.log(imageEditor.getImageName());\n     */\n    getImageName: function() {\n        return this._getMainComponent().getImageName();\n    },\n\n    /**\n     * Clear undoStack\n     * @api\n     * @example\n     * imageEditor.clearUndoStack();\n     */\n    clearUndoStack: function() {\n        this._invoker.clearUndoStack();\n    },\n\n    /**\n     * Clear redoStack\n     * @api\n     * @example\n     * imageEditor.clearRedoStack();\n     */\n    clearRedoStack: function() {\n        this._invoker.clearRedoStack();\n    }\n});\n\ntui.util.CustomEvents.mixin(ImageEditor);\nmodule.exports = ImageEditor;\n</code></pre>\n        </article>\n    </section>\n\n\n\n</div>\n\n"